<!DOCTYPE html>
<html id="mainHtml">

<head>
    <meta charset="UTF-8">
    <title>Expenses Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #f5f5f5;
        }

        .navbar {
            background: #667eea;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
        }

        .navbar button {
            background: white;
            color: #667eea;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 20px;
        }

        .form-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        input,
        select,
        textarea {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            grid-column: 1 / -1;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 30px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 5px;
            cursor: pointer;
            color: #667eea;
            font-weight: bold;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        table {
            width: 100%;
            background: white;
            border-collapse: collapse;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
        }

        .delete-btn {
            background: #e74c3c;
            padding: 5px 15px;
            font-size: 14px;
        }

        .summary {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-box h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .summary-box p {
            font-size: 28px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <h1 id="pageTitle">Expenses Management</h1>
        <button onclick="window.location.href='dashboard.html'" id="homeBtn">üè† Dashboard</button>
    </div>

    <div class="container">
        <div class="summary">
            <div class="summary-box">
                <h3 id="todayPersonalLabel">Today Personal</h3>
                <p id="todayPersonal">0 Rs</p>
            </div>
            <div class="summary-box">
                <h3 id="todayShopLabel">Today Shop</h3>
                <p id="todayShop">0 Rs</p>
            </div>
            <div class="summary-box">
                <h3 id="monthPersonalLabel">Month Personal</h3>
                <p id="monthPersonal">0 Rs</p>
            </div>
            <div class="summary-box">
                <h3 id="monthShopLabel">Month Shop</h3>
                <p id="monthShop">0 Rs</p>
            </div>
        </div>

        <div class="form-card">
            <h2 id="addExpTitle">Add New Expense</h2>
            <div class="form-row">
                <select id="expenseType">
                    <option value="personal" id="optPersonal">Personal Expense</option>
                    <option value="shop" id="optShop">Shop Expense</option>
                </select>
                <input type="number" id="expenseAmount" placeholder="Amount" step="0.01">
                <input type="date" id="expenseDate">
            </div>
            <textarea id="expenseReason" placeholder="Reason for expense"></textarea>
            <button onclick="addExpense()" style="margin-top: 15px;" id="addBtn">‚ûï Add Expense</button>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('all')" id="tabAll">All</div>
            <div class="tab" onclick="showTab('personal')" id="tabPersonal">Personal</div>
            <div class="tab" onclick="showTab('shop')" id="tabShop">Shop</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th id="thAction">Actions</th>
                    <th id="thReason">Reason</th>
                    <th id="thAmount">Amount</th>
                    <th id="thType">Type</th>
                    <th id="thDate">Date</th>
                    <th>#</th>
                </tr>
            </thead>
            <tbody id="expensesBody"></tbody>
        </table>
    </div>

    <script>
        let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        let currentFilter = 'all';

        const translations = {
            ur: {
                pageTitle: 'ÿßÿÆÿ±ÿßÿ¨ÿßÿ™ ⁄©ÿß ŸÜÿ∏ÿßŸÖ',
                homeBtn: 'üè† ⁄à€åÿ¥ ÿ®Ÿàÿ±⁄à',
                todayPersonalLabel: 'ÿ¢ÿ¨ ÿ∞ÿßÿ™€å',
                todayShopLabel: 'ÿ¢ÿ¨ ÿØ⁄©ÿßŸÜ',
                monthPersonalLabel: 'ŸÖÿß€Å ÿ∞ÿßÿ™€å',
                monthShopLabel: 'ŸÖÿß€Å ÿØ⁄©ÿßŸÜ',
                addExpTitle: 'ŸÜ€åÿß ÿßÿÆÿ±ÿßÿ¨ÿßÿ™ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫',
                optPersonal: 'ÿ∞ÿßÿ™€å ÿßÿÆÿ±ÿßÿ¨ÿßÿ™',
                optShop: 'ÿØ⁄©ÿßŸÜ ⁄©€í ÿßÿÆÿ±ÿßÿ¨ÿßÿ™',
                addBtn: '‚ûï ÿßÿÆÿ±ÿßÿ¨ÿßÿ™ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫',
                tabAll: 'ÿ™ŸÖÿßŸÖ',
                tabPersonal: 'ÿ∞ÿßÿ™€å',
                tabShop: 'ÿØ⁄©ÿßŸÜ',
                thAction: 'ÿß€å⁄©ÿ¥ŸÜ',
                thReason: 'Ÿàÿ¨€Å',
                thAmount: 'ÿ±ŸÇŸÖ',
                thType: 'ŸÇÿ≥ŸÖ',
                thDate: 'ÿ™ÿßÿ±€åÿÆ',
                personal: 'ÿ∞ÿßÿ™€å',
                shop: 'ÿØ⁄©ÿßŸÜ'
            },
            en: {
                pageTitle: 'Expenses Management',
                homeBtn: 'üè† Dashboard',
                todayPersonalLabel: 'Today Personal',
                todayShopLabel: 'Today Shop',
                monthPersonalLabel: 'Month Personal',
                monthShopLabel: 'Month Shop',
                addExpTitle: 'Add New Expense',
                optPersonal: 'Personal Expense',
                optShop: 'Shop Expense',
                addBtn: '‚ûï Add Expense',
                tabAll: 'All',
                tabPersonal: 'Personal',
                tabShop: 'Shop',
                thAction: 'Actions',
                thReason: 'Reason',
                thAmount: 'Amount',
                thType: 'Type',
                thDate: 'Date',
                personal: 'Personal',
                shop: 'Shop'
            }
        };

        function getTodayDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function applyLanguage() {
            const lang = localStorage.getItem('language') || 'en';
            const t = translations[lang];
            document.getElementById('mainHtml').dir = lang === 'ur' ? 'rtl' : 'ltr';

            document.getElementById('pageTitle').textContent = t.pageTitle;
            document.getElementById('homeBtn').textContent = t.homeBtn;
            document.getElementById('todayPersonalLabel').textContent = t.todayPersonalLabel;
            document.getElementById('todayShopLabel').textContent = t.todayShopLabel;
            document.getElementById('monthPersonalLabel').textContent = t.monthPersonalLabel;
            document.getElementById('monthShopLabel').textContent = t.monthShopLabel;
            document.getElementById('addExpTitle').textContent = t.addExpTitle;
            document.getElementById('optPersonal').textContent = t.optPersonal;
            document.getElementById('optShop').textContent = t.optShop;
            document.getElementById('addBtn').textContent = t.addBtn;
            document.getElementById('tabAll').textContent = t.tabAll;
            document.getElementById('tabPersonal').textContent = t.tabPersonal;
            document.getElementById('tabShop').textContent = t.tabShop;
            document.getElementById('thAction').textContent = t.thAction;
            document.getElementById('thReason').textContent = t.thReason;
            document.getElementById('thAmount').textContent = t.thAmount;
            document.getElementById('thType').textContent = t.thType;
            document.getElementById('thDate').textContent = t.thDate;

            loadSummary();
            loadExpenses();
        }

        function addExpense() {
            const type = document.getElementById('expenseType').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const date = document.getElementById('expenseDate').value;
            const reason = document.getElementById('expenseReason').value.trim();

            if (!amount || isNaN(amount) || amount <= 0) {
                alert('Please enter a valid amount');
                return false; // Add return false
            }

            if (!date) {
                alert('Please select a date');
                return false; // Add return false
            }

            if (!reason) {
                alert('Please enter reason for expense');
                return false; // Add return false
            }

            const dateObj = new Date(date + 'T00:00:00');

            const expense = {
                id: Date.now(),
                type,
                amount,
                date: dateObj.toISOString(),
                reason
            };

            expenses.push(expense);
            localStorage.setItem('expenses', JSON.stringify(expenses));

            // Clear immediately
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDate').value = '';
            document.getElementById('expenseReason').value = '';

            loadSummary();
            loadExpenses();
            alert('Expense added successfully');
            return false;
        }

        function deleteExpense(id) {
            if (confirm('Delete this expense?')) {
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('expenses', JSON.stringify(expenses));
                loadSummary();
                loadExpenses();
            }
        }

        function showTab(filter) {
            currentFilter = filter;
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            if (filter === 'all') {
                document.getElementById('tabAll').classList.add('active');
            } else if (filter === 'personal') {
                document.getElementById('tabPersonal').classList.add('active');
            } else {
                document.getElementById('tabShop').classList.add('active');
            }
            loadExpenses();
        }

        function loadSummary() {
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const thisMonth = today.getMonth();
            const thisYear = today.getFullYear();

            const todayExp = expenses.filter(e => {
                if (!e.date) return false;
                const expDate = new Date(e.date);
                const expDateStr = `${expDate.getFullYear()}-${String(expDate.getMonth() + 1).padStart(2, '0')}-${String(expDate.getDate()).padStart(2, '0')}`;
                return expDateStr === todayStr;
            });

            const monthExp = expenses.filter(e => {
                if (!e.date) return false;
                const d = new Date(e.date);
                return d.getMonth() === thisMonth && d.getFullYear() === thisYear;
            });

            const todayPersonal = todayExp.filter(e => e.type === 'personal').reduce((sum, e) => sum + parseFloat(e.amount || 0), 0);
            const todayShop = todayExp.filter(e => e.type === 'shop').reduce((sum, e) => sum + parseFloat(e.amount || 0), 0);
            const monthPersonal = monthExp.filter(e => e.type === 'personal').reduce((sum, e) => sum + parseFloat(e.amount || 0), 0);
            const monthShop = monthExp.filter(e => e.type === 'shop').reduce((sum, e) => sum + parseFloat(e.amount || 0), 0);

            document.getElementById('todayPersonal').textContent = todayPersonal.toLocaleString() + ' Rs';
            document.getElementById('todayShop').textContent = todayShop.toLocaleString() + ' Rs';
            document.getElementById('monthPersonal').textContent = monthPersonal.toLocaleString() + ' Rs';
            document.getElementById('monthShop').textContent = monthShop.toLocaleString() + ' Rs';
        }

        function loadExpenses() {
            const lang = localStorage.getItem('language') || 'en';
            const t = translations[lang];

            let filtered = expenses;
            if (currentFilter !== 'all') {
                filtered = expenses.filter(e => e.type === currentFilter);
            }

            const tbody = document.getElementById('expensesBody');
            tbody.innerHTML = filtered.reverse().map((e, i) => `
                <tr>
                    <td><button class="delete-btn" onclick="deleteExpense(${e.id})">üóë Delete</button></td>
                    <td>${e.reason}</td>
                    <td><strong>${parseFloat(e.amount).toLocaleString()}</strong></td>
                    <td>${t[e.type]}</td>
                    <td>${new Date(e.date).toLocaleDateString()}</td>
                    <td>${i + 1}</td>
                </tr>
            `).join('');
        }

        document.getElementById('expenseDate').valueAsDate = new Date();

        applyLanguage();
    </script>
</body>

</html>