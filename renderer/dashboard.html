<!DOCTYPE html>
<html id="mainHtml">

<head>
    <meta charset="UTF-8">
    <title>Dashboard - AL Fatah</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #f5f5f5;
        }

        .navbar {
            background: #667eea;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            font-size: 24px;
        }

        .navbar-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .navbar button,
        .lang-btn {
            background: #764ba2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .lang-btn {
            background: #27ae60;
        }

        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 20px;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .card p {
            color: #666;
            font-size: 32px;
            font-weight: bold;
        }

        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .menu-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 18px;
            font-weight: bold;
        }

        .menu-item:hover {
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <div class="navbar">
        <h1 id="navTitle">AL Fatah Spray Center - Dashboard</h1>
        <div class="navbar-right">
            <button class="lang-btn" onclick="toggleLanguage()" id="langBtn">ğŸŒ Ø§Ø±Ø¯Ùˆ</button>
            <span id="userName" style="margin-right: 10px;"></span>
            <button onclick="logout()" id="logoutBtn">Logout</button>
        </div>
    </div>

    <div class="container">
        <div class="cards">
            <div class="card">
                <h2 id="totalProdLabel">Total Products</h2>
                <p id="totalProducts">0</p>
            </div>
            <div class="card">
                <h2 id="todaySalesLabel">Today's Sales</h2>
                <p id="todaySales">0 Rs</p>
            </div>
            <div class="card">
                <h2 id="totalLoansLabel">Pending Loans</h2>
                <p id="totalLoans">0 Rs</p>
            </div>
            <div class="card">
                <h2 id="creditSalesLabel">Credit Sales</h2>
                <p id="creditSales">0 Rs</p>
            </div>
            <div class="card">
                <h2 id="personalExpLabel">Personal Expenses</h2>
                <p id="personalExp">0 Rs</p>
            </div>
            <div class="card">
                <h2 id="shopExpLabel">Shop Expenses</h2>
                <p id="shopExp">0 Rs</p>
            </div>
        </div>

        <div class="menu">
            <div class="menu-item" onclick="goto('products.html')">
                <span id="menuProd">ğŸ“¦ Products<br>Ù…ØµÙ†ÙˆØ¹Ø§Øª</span>
            </div>
            <div class="menu-item" onclick="goto('sales.html')">
                <span id="menuSales">ğŸ›’ Sales Slip<br>ÙØ±ÙˆØ®Øª Ø³Ù„Ù¾</span>
            </div>
            <div class="menu-item" onclick="goto('expenses.html')">
                <span id="menuExp">ğŸ’¸ Expenses<br>Ø§Ø®Ø±Ø§Ø¬Ø§Øª</span>
            </div>
            <div class="menu-item" onclick="goto('loans.html')">
                <span id="menuLoans">ğŸ’° Loans<br>Ù‚Ø±Ø¶Û’</span>
            </div>
            <div class="menu-item" onclick="goto('credits.html')">
                <span id="menuCredits">ğŸ“ Credit Sales<br>Ø§Ø¯Ú¾Ø§Ø± ÙØ±ÙˆØ®Øª</span>
            </div>
            <div class="menu-item" onclick="goto('reports.html')">
                <span id="menuReports">ğŸ“Š Reports<br>Ø±Ù¾ÙˆØ±Ù¹Ø³</span>
            </div>
            <div class="menu-item" onclick="goto('sales-history.html')">
                <span id="menuHistory">ğŸ“œ Sales History<br>ÙØ±ÙˆØ®Øª Ú©ÛŒ ØªØ§Ø±ÛŒØ®</span>
            </div>
            <div class="menu-item" onclick="goto('backup.html')">
                <span id="menuBackup">ğŸ’¾ Backup<br>Ø¨ÛŒÚ© Ø§Ù¾</span>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            ur: {
                navTitle: 'AL Fatah Spray Center - ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ',
                logoutBtn: 'Ù„Ø§Ú¯ Ø¢Ø¤Ù¹',
                totalProdLabel: 'Ú©Ù„ Ù…ØµÙ†ÙˆØ¹Ø§Øª',
                todaySalesLabel: 'Ø¢Ø¬ Ú©ÛŒ ÙØ±ÙˆØ®Øª',
                totalLoansLabel: 'Ø¨Ø§Ù‚ÛŒ Ù‚Ø±Ø¶Û’',
                creditSalesLabel: 'Ø§Ø¯Ú¾Ø§Ø± ÙØ±ÙˆØ®Øª',
                personalExpLabel: 'Ø°Ø§ØªÛŒ Ø§Ø®Ø±Ø§Ø¬Ø§Øª',
                shopExpLabel: 'Ø¯Ú©Ø§Ù† Ú©Û’ Ø§Ø®Ø±Ø§Ø¬Ø§Øª',
                menuProd: 'ğŸ“¦ Ù…ØµÙ†ÙˆØ¹Ø§Øª',
                menuSales: 'ğŸ›’ ÙØ±ÙˆØ®Øª Ø³Ù„Ù¾',
                menuExp: 'ğŸ’¸ Ø§Ø®Ø±Ø§Ø¬Ø§Øª',
                menuLoans: 'ğŸ’° Ù‚Ø±Ø¶Û’',
                menuCredits: 'ğŸ“ Ø§Ø¯Ú¾Ø§Ø± ÙØ±ÙˆØ®Øª',
                menuReports: 'ğŸ“Š Ø±Ù¾ÙˆØ±Ù¹Ø³',
                menuHistory: 'ğŸ“œ ÙØ±ÙˆØ®Øª Ú©ÛŒ ØªØ§Ø±ÛŒØ®',
                menuBackup: 'ğŸ’¾ Ø¨ÛŒÚ© Ø§Ù¾',
                rs: 'Ø±ÙˆÙ¾Û’'
            },
            en: {
                navTitle: 'AL Fatah Spray Center - Dashboard',
                logoutBtn: 'Logout',
                totalProdLabel: 'Total Products',
                todaySalesLabel: "Today's Sales",
                totalLoansLabel: 'Pending Loans',
                creditSalesLabel: 'Credit Sales',
                personalExpLabel: 'Personal Expenses',
                shopExpLabel: 'Shop Expenses',
                menuProd: 'ğŸ“¦ Products',
                menuSales: 'ğŸ›’ Sales Slip',
                menuExp: 'ğŸ’¸ Expenses',
                menuLoans: 'ğŸ’° Loans',
                menuCredits: 'ğŸ“ Credit Sales',
                menuReports: 'ğŸ“Š Reports',
                menuHistory: 'ğŸ“œ Sales History',
                menuBackup: 'ğŸ’¾ Backup',
                rs: 'Rs'
            }
        };

        function toggleLanguage() {
            const currentLang = localStorage.getItem('language') || 'en';
            const newLang = currentLang === 'en' ? 'ur' : 'en';
            localStorage.setItem('language', newLang);
            applyLanguage();
        }

        function applyLanguage() {
            const lang = localStorage.getItem('language') || 'en';
            const t = translations[lang];

            document.getElementById('mainHtml').dir = lang === 'ur' ? 'rtl' : 'ltr';
            document.getElementById('navTitle').textContent = t.navTitle;
            document.getElementById('logoutBtn').textContent = t.logoutBtn;
            document.getElementById('totalProdLabel').textContent = t.totalProdLabel;
            document.getElementById('todaySalesLabel').textContent = t.todaySalesLabel;
            document.getElementById('totalLoansLabel').textContent = t.totalLoansLabel;
            document.getElementById('creditSalesLabel').textContent = t.creditSalesLabel;
            document.getElementById('personalExpLabel').textContent = t.personalExpLabel;
            document.getElementById('shopExpLabel').textContent = t.shopExpLabel;
            document.getElementById('menuProd').innerHTML = t.menuProd;
            document.getElementById('menuSales').innerHTML = t.menuSales;
            document.getElementById('menuExp').innerHTML = t.menuExp;
            document.getElementById('menuLoans').innerHTML = t.menuLoans;
            document.getElementById('menuCredits').innerHTML = t.menuCredits;
            document.getElementById('menuReports').innerHTML = t.menuReports;
            document.getElementById('menuHistory').innerHTML = t.menuHistory;
            document.getElementById('menuBackup').innerHTML = t.menuBackup;
            document.getElementById('langBtn').textContent = lang === 'en' ? 'ğŸŒ Ø§Ø±Ø¯Ùˆ' : 'ğŸŒ English';

            loadDashboard();
        }

        function checkAuth() {
            const user = localStorage.getItem('currentUser');
            if (!user) {
                window.location.href = 'index.html';
                return null;
            }
            return JSON.parse(user);
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        function goto(page) {
            window.location.href = page;
        }

        function getTodayDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function loadDashboard() {
            const user = checkAuth();
            if (!user) return;

            const lang = localStorage.getItem('language') || 'en';
            const t = translations[lang];

            document.getElementById('userName').textContent = user.name;

            const products = JSON.parse(localStorage.getItem('products') || '[]');
            document.getElementById('totalProducts').textContent = products.length;

            const sales = JSON.parse(localStorage.getItem('salesSlips') || '[]');
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

            const todaySales = sales.filter(s => {
                if (!s.date) return false;
                const saleDate = new Date(s.date);
                const saleDateStr = `${saleDate.getFullYear()}-${String(saleDate.getMonth() + 1).padStart(2, '0')}-${String(saleDate.getDate()).padStart(2, '0')}`;
                return saleDateStr === todayStr;
            }).reduce((sum, s) => sum + (s.total || 0), 0);

            document.getElementById('todaySales').textContent = todaySales.toLocaleString() + ' ' + t.rs;

            const loans = JSON.parse(localStorage.getItem('loans') || '[]');
            const totalLoans = loans.reduce((sum, l) => sum + ((l.amount || 0) - (l.paid || 0)), 0);
            document.getElementById('totalLoans').textContent = totalLoans.toLocaleString() + ' ' + t.rs;

            const credits = JSON.parse(localStorage.getItem('credits') || '[]');
            const creditSales = credits.reduce((sum, c) => sum + ((c.amount || 0) - (c.paid || 0)), 0);
            document.getElementById('creditSales').textContent = creditSales.toLocaleString() + ' ' + t.rs;

            const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');

            let personalExp = 0;
            let shopExp = 0;

            expenses.forEach(e => {
                if (!e.date) return;

                let expDateStr;
                if (e.date.includes('T')) {
                    // ISO format
                    const expDate = new Date(e.date);
                    expDateStr = `${expDate.getFullYear()}-${String(expDate.getMonth() + 1).padStart(2, '0')}-${String(expDate.getDate()).padStart(2, '0')}`;
                } else {
                    // Simple YYYY-MM-DD format
                    expDateStr = e.date;
                }

                if (expDateStr === todayStr) {
                    const amount = parseFloat(e.amount);
                    if (!isNaN(amount)) {
                        if (e.type === 'personal') {
                            personalExp += amount;
                        } else if (e.type === 'shop') {
                            shopExp += amount;
                        }
                    }
                }
            });

            document.getElementById('personalExp').textContent = personalExp.toLocaleString() + ' ' + t.rs;
            document.getElementById('shopExp').textContent = shopExp.toLocaleString() + ' ' + t.rs;
        }

        applyLanguage();
    </script>
</body>

</html>